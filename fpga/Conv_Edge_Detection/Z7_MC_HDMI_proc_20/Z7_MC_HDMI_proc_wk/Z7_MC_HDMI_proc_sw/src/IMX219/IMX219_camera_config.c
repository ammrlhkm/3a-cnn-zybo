#include "IMX219_camera.h"


/* 640 x 480 @ 30 fps */
/*
 * MIPI Link   : 291.667 Mbps
 * Pixel clock : 58.333 MHz
 * Timing zone : 1896 x 984
 * FPS         : 30
 */

IMX219_cam_reg IMX219_640_480_15_ref[] = {


		/* Access Code needed to access registers over 0x3000 */
		{0x30EB, 0x05},
		{0x30EB, 0x0C},
		{0x300A, 0xFF},
		{0x300B, 0xFF},
		{0x30EB, 0x05},
		{0x30EB, 0x09},

		/* number of csi lanes = 2 (1 + 1) */
		{0x0114, 0x01},

		/* dphy control: Auto */
		{0x0128, 0x00},

		/* external clock frequency = 24MHz */
		{0x012A, 0x18}, // 24 MHz
		{0x012B, 0x00}, // 000 KHz




		//Configure the camera for 640x480 (1280x720 with 2X2 binning)


		// analogue gain setting
		{0x0157, 0x00},
		//Digital gain
		{0x0158, 0x08}, {0x0159, 0x00},

		// Frame Length: 569
		//{0x0160, 0x02}, {0x0161, 0x39},
		//{0x0160, 0x04}, {0x0161, 0x04},
		{0x0160, 0x02}, {0x0161, 0x89},

		//Coarse Time = 565 (Exposure, can be adjusted while the camera is running)
		//{0x015A, 0x02}, {0x015B, 0x35},
         //{0x015A, 0x05}, {0x015B, 0xFC},
         {0x015A, 0x02}, {0x015B, 0x85},
        //{0x015A, 0x00}, {0x015B, 0x04},

		// Line Length: 3559
		{0x0162, 0x0D}, {0x0163, 0xE8},


		// Window Width: 2279 - 1000 = 1280 - 1

		// crop_rect.left: 1000
		{0x0164, 0x03}, {0x0165, 0xE8},
		// crop_rect.width: 2279
		{0x0166, 0x08}, {0x0167, 0xE7},

		// Window Height: 1711 - 752 = 960 - 1 (2 X 480)

		// crop_rect.top: 752
		{0x0168, 0x02}, {0x0169, 0xF0},
		// crop_rect.height: 1711
		{0x016A, 0x06}, {0x016B, 0xAF},

		// image width = 640
		{0x016C, 0x02}, {0x016D, 0x80},
		// image height = 480
		{0x016E, 0x01}, {0x016F, 0xE0},



		/* X odd increment */
		//{0x0170, 0x03},
		{0x0170, 0x01},

		/* Y odd increment */
		//{0x0171, 0x03},
		{0x0171, 0x01},

		/* Binning Mode: X (2) */
		//{0x0174, 0x04},
		{0x0174, 0x03}, //2X Analog Binning
		//{0x0174, 0x00},

		/* Binning Mode: Y (2) */
		{0x0175, 0x03}, //2X Analog Binning
		//{0x0175, 0x00},
		//{0x0175, 0x02},

		//  {0x0176, 0x01},
		//  {0x0177, 0x01},


         // Color bar
		 //{0x0600, 0xFF},
		// {0x0601, 0x01},
		// V polarity
		 //{0x0144, 0x1},
		 //{0x0144, 0x1},


		//Clock Settings


		// CSI data format
		//{0x018C, 0x0A}, {0x018D, 0x0A}, //10-Bits
		{0x018C, 0x08}, {0x018D, 0x08}, //8-Bits

		// PIXEL CLOCK USED TO DRIVE SENSOR)
		// VTPXCK_DIV: 4: 1/4, 5: 1/5, 8: 1/8, 10: 1/10
		//{0x0301, 0x05}, // 10-bit configuration
		{0x0301, 0x04},   // 8-bit configuration

		// VTSYS_DIV = 1: Divide by 1
		{0x0303, 0x01},

		// PREPLLCK_VT_DIV: 1: 1/1, 2: 1/2, 3: 1/3
		{0x0304, 0x03}, //MUST BE 3 FOR 24MHz

		// PREPLLCK_OP_DIV: 1: 1/1, 2: 1/2, 3: 1/3
		{0x0305, 0x03}, //MUST BE 3 FOR 24MHz

		// PLL_VT_MPY = 57 (Multiplier)
		//{0x0306, 0x00}, {0x0307, 0x39},
		//{0x0306, 0x00}, {0x0307, 0x18},
		{0x0306, 0x00}, {0x0307, 0x10},

		// OPPXCK_DIV (pixel bit depth): 8:1/8 10:1/10
		//{0x0309, 0x0A}, //10-Bits
		{0x0309, 0x08},   //8-Bits

		// OPSYSCK_DIV (divide by two for double data rate): 1:1/2
		{0x030B, 0x01},

		// PLL_OP_MPY = 114 (Multiplier)
		//{0x030C, 0x00}, {0x030D, 0x72},
		//{0x030C, 0x00}, {0x030D, 0x30},
		{0x030C, 0x00}, {0x030D, 0x20},

		//Pixel Clock (10-bit Config): EXCLK_FREQ / PREPLLLCK_VT_DIV * PLL_VT_MPY / VTPXCK_DIV: 24MHz / 3 * 57 / 5 = 91 MHz

		// CIS tunning
		{0x455E, 0x00},
		{0x471E, 0x4B},
		{0x4767, 0x0F},
		{0x4750, 0x14},
		{0x4540, 0x00},
		{0x47B4, 0x14},
		{0x4713, 0x30},
		{0x478B, 0x10},
		{0x478F, 0x10},
		{0x4793, 0x10},
		{0x4797, 0x0E},
		{0x479B, 0x0E}
};
IMX219_cam_reg IMX219_640_480_15_fast[] = {


		/* Access Code needed to access registers over 0x3000 */
		{0x30EB, 0x05},
		{0x30EB, 0x0C},
		{0x300A, 0xFF},
		{0x300B, 0xFF},
		{0x30EB, 0x05},
		{0x30EB, 0x09},

		/* number of csi lanes = 2 (1 + 1) */
		{0x0114, 0x01},

		/* dphy control: Auto */
		{0x0128, 0x00},

		/* external clock frequency = 24MHz */
		{0x012A, 0x18}, // 24 MHz
		{0x012B, 0x00}, // 000 KHz




		//Configure the camera for 640x480 (1280x720 with 2X2 binning)


		// analogue gain setting
		{0x0157, 0x00},
		//Digital gain
		{0x0158, 0x00}, {0x0159, 0x80},

		// Frame Length: 569
		//{0x0160, 0x02}, {0x0161, 0x39},
		//{0x0160, 0x04}, {0x0161, 0x04},
		{0x0160, 0x02}, {0x0161, 0x8A},

		//Coarse Time = 565 (Exposure, can be adjusted while the camera is running)
		//{0x015A, 0x02}, {0x015B, 0x35},
         //{0x015A, 0x05}, {0x015B, 0xFC},
         {0x015A, 0x04}, {0x015B, 0x85},
        //{0x015A, 0x00}, {0x015B, 0x04},

		// Line Length: 3559
		{0x0162, 0x0D}, {0x0163, 0xE2}, //DE2


		// Window Width: 2279 - 1000 = 1280 - 1

		// crop_rect.left: 1000
		{0x0164, 0x03}, {0x0165, 0xE8},
		// crop_rect.width: 2279
		{0x0166, 0x08}, {0x0167, 0xE7},

		// Window Height: 1711 - 752 = 960 - 1 (2 X 480)

		// crop_rect.top: 752
		{0x0168, 0x02}, {0x0169, 0xF0},
		// crop_rect.height: 1711
		{0x016A, 0x06}, {0x016B, 0xAF},

		// image width = 640
		{0x016C, 0x02}, {0x016D, 0x80},
		// image height = 480
		{0x016E, 0x01}, {0x016F, 0xE0},



		/* X odd increment */
		//{0x0170, 0x03},
		{0x0170, 0x01},

		/* Y odd increment */
		//{0x0171, 0x03},
		{0x0171, 0x01},

		/* Binning Mode: X (2) */
		//{0x0174, 0x04},
		{0x0174, 0x03}, //2X Analog Binning
		//{0x0174, 0x00},

		/* Binning Mode: Y (2) */
		{0x0175, 0x03}, //2X Analog Binning
		//{0x0175, 0x00},
		//{0x0175, 0x02},

		//  {0x0176, 0x01},
		//  {0x0177, 0x01},



		// V polarity
		 //{0x0144, 0x1},
		 //{0x0144, 0x1},


		//Clock Settings


		// CSI data format
		//{0x018C, 0x0A}, {0x018D, 0x0A}, //10-Bits
		{0x018C, 0x08}, {0x018D, 0x08}, //8-Bits

		// PIXEL CLOCK USED TO DRIVE SENSOR)
		// VTPXCK_DIV: 4: 1/4, 5: 1/5, 8: 1/8, 10: 1/10
		//{0x0301, 0x05}, // 10-bit configuration
		{0x0301, 0x04},   // 8-bit configuration

		// VTSYS_DIV = 1: Divide by 1
		{0x0303, 0x01},

		// PREPLLCK_VT_DIV: 1: 1/1, 2: 1/2, 3: 1/3
		{0x0304, 0x03}, //MUST BE 3 FOR 24MHz

		// PREPLLCK_OP_DIV: 1: 1/1, 2: 1/2, 3: 1/3
		{0x0305, 0x03}, //MUST BE 3 FOR 24MHz

		// PLL_VT_MPY = 57 (Multiplier)
		//{0x0306, 0x00}, {0x0307, 0x39},
		//{0x0306, 0x00}, {0x0307, 0x18},
		{0x0306, 0x00}, {0x0307, 0x10},

		// OPPXCK_DIV (pixel bit depth): 8:1/8 10:1/10
		//{0x0309, 0x0A}, //10-Bits
		{0x0309, 0x08},   //8-Bits

		// OPSYSCK_DIV (divide by two for double data rate): 1:1/2
		{0x030B, 0x01},

		// PLL_OP_MPY = 114 (Multiplier)
		//{0x030C, 0x00}, {0x030D, 0x72},
		//{0x030C, 0x00}, {0x030D, 0x30},
		{0x030C, 0x00}, {0x030D, 0x20},

		//Pixel Clock (10-bit Config): EXCLK_FREQ / PREPLLLCK_VT_DIV * PLL_VT_MPY / VTPXCK_DIV: 24MHz / 3 * 57 / 5 = 91 MHz

		// CIS tunning
		{0x455E, 0x00},
		{0x471E, 0x4B},
		{0x4767, 0x0F}, //0x0F
		{0x4750, 0x14}, //0x14
		{0x4540, 0x00},
		{0x47B4, 0x14},  //14
		{0x4713, 0x30},
		{0x478B, 0x10},
		{0x478F, 0x10},
		{0x4793, 0x10},
		{0x4797, 0x0E},
		{0x479B, 0x0E},
		// Green gain
		//{0x0190, 0x01},
		//{0x0199, 0x01},
		//{0x019A, 0x00},

		 // Color bar
				 //{0x0600, 0xFF},
				 {0x0601, 0x00}, //0x2
				 {0x0603, 0xFF},
				 {0x0624, 0x02},
				 {0x0625, 0x80},
				 {0x0626, 0x01},
				 {0x0627, 0xE0}


};

int IMX219_640_480_15_n = sizeof(IMX219_640_480_15)/sizeof(IMX219_cam_reg);

